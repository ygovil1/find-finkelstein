<!DOCTYPE html>
<html lang="en">

<head>
	<title>find finkelstein</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
	<style>
		html,
		body {
			width: 100%;
			height: 100%;
		}

		body {
			background-color: #ffffff;
			margin: 0;
			overflow: hidden;
			font-family: arial;
		}

		#blocker {
			position: absolute;
			width: 100%;
			height: 90%;
			background-color: rgba(0, 0, 0, 0.5);
		}


		#instructions {
			width: 100%;
			height: 100%;
			display: -webkit-box;
			display: -moz-box;
			display: box;
			-webkit-box-orient: horizontal;
			-moz-box-orient: horizontal;
			box-orient: horizontal;
			-webkit-box-pack: center;
			-moz-box-pack: center;
			box-pack: center;
			-webkit-box-align: center;
			-moz-box-align: center;
			box-align: center;
			color: #ffffff;
			text-align: center;
			cursor: pointer;
		}

		#inventory {
			position:absolute;
			bottom:0;
			width: 100%;
			height: 10%;
			background-color: rgba(0, 0, 0, 0.7);
			display: inline;
		}

		.button {
			height: 100%;
			background-color: #555555;
			border-radius: 8px;
			border: none;
  		color: white;
  		padding: 10px 12px;
			text-align: center;
			text-decoration: none;
			display: inline-block;
			font-size: 16px;
		}

		#invSlot {
			display: inline;
		}

		#key {
			max-width: 50%;
    	max-height: 80%;
		}

		#fuse {
			max-width: 50%;
    	max-height: 80%;
		}
	</style>
</head>


<body>
	<script src="js/three.js"></script>
	<script src="js/PointerLockControls.js"></script>
	<script src="js/OBJLoader.js"></script>
	<script src="js/ColladaLoader.js"></script>

	<div id="blocker">

		<div id="instructions">
			<span style="font-size:40px">Looking for Finkelstein?</span>
			<br /><br>
			Welcome to Firestone!<br><br>
			You need to submit your 426 Dean's Date assignment but you can't find your Graphics professor! Gather clues to find him. <br><br>
			Move forward and backward with Up and Down keys. Rotate views with your mouse.<br><br>
			Press Esc to pause game. Click anywhere to begin.
		</div>

	</div>

	<div id="inventory"></div>
	
	<script src="js/Inventory.js"></script>

	<script>
		var camera, scene, renderer, controls;
		var objects = [];
		var raycaster;

		var moveForward = false;
		var moveBackward = false;
		var moveLeft = false;
		var moveRight = false;
		var canJump = false;

		var prevTime = performance.now();

		var velocity = new THREE.Vector3();
		var direction = new THREE.Vector3();
		var vertex = new THREE.Vector3();
		var color = new THREE.Color();

		var playerInventory = Inventory();

		init();
		animate();

		function init() {
			camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
			camera.position.set(-100, 50, 200); // Set position like this
			// camera.position.set(-100, 50, -200);			// this position is for editing items on the other side of the room 
			camera.lookAt(new THREE.Vector3(-100, 50, -250));
			scene = new THREE.Scene();
			scene.background = new THREE.Color(0xffffff);
			scene.fog = new THREE.Fog(0xffffff, 0, 750);
			var light = new THREE.HemisphereLight(0xe5ceae, 0x789ea0, 0.75);
			light.position.set(0.5, 1, 0.75);
			scene.add(light);

			controls = new THREE.PointerLockControls(camera);


			var blocker = document.getElementById('blocker');
			var instructions = document.getElementById('instructions');
			instructions.addEventListener('click', function () {
				controls.lock();
			}, false);


			controls.addEventListener('lock', function () {        // ?????
				instructions.style.display = 'none';
				blocker.style.display = 'none';
			});

			controls.addEventListener('unlock', function () {      // ?????
				blocker.style.display = 'block';
				instructions.style.display = '';
			});

			scene.add(controls.getObject());

			var onKeyDown = function (event) {
				switch (event.keyCode) {
					case 38: // up
					case 87: // w
						moveForward = true;
						break;
					case 37: // left
					case 65: // a
						moveLeft = true;
						break;
					case 40: // down
					case 83: // s
						moveBackward = true;
						break;
					case 39: // right
					case 68: // d
						moveRight = true;
						break;
					case 32: // space
						if (canJump === true) velocity.y += 350;
						canJump = false;
						break;
				}
			};
			var onKeyUp = function (event) {
				switch (event.keyCode) {
					case 38: // up
					case 87: // w
						moveForward = false;
						break;
					case 37: // left
					case 65: // a
						moveLeft = false;
						break;
					case 40: // down
					case 83: // s
						moveBackward = false;
						break;
					case 39: // right
					case 68: // d
						moveRight = false;
						break;
				}
			};

			document.addEventListener('keydown', onKeyDown, false);
			document.addEventListener('keyup', onKeyUp, false);



			raycaster = new THREE.Raycaster(new THREE.Vector3(), new THREE.Vector3(0, - 1, 0), 0, 10);

			// back wall
			var southWallGeometry = new THREE.PlaneBufferGeometry(100, 400, 20, 20);
			southWallGeometry.rotateZ(- Math.PI / 2);
			southWallGeometry.translate(0, 50, -250);

			// right wall
			var rightWallGeometry = new THREE.PlaneBufferGeometry(100, 500, 20, 20);
			rightWallGeometry.rotateZ(-Math.PI/2);
			rightWallGeometry.rotateY(-Math.PI/2);
			rightWallGeometry.translate(200, 50, 0);

			// left wall
			var leftWallGeometry = new THREE.PlaneBufferGeometry(100, 500, 20, 20);
			leftWallGeometry.rotateZ(Math.PI/2);
			leftWallGeometry.rotateY(Math.PI/2);
			leftWallGeometry.translate(-200, 50, 0);

			// front wall
			var frontWallGeometry = new THREE.PlaneBufferGeometry(100, 400, 20, 20);
			frontWallGeometry.rotateZ(-Math.PI/2);
			frontWallGeometry.translate(0, 50, 250);

			// floor rendering                TODO: fix to Firestone floor!
			var floorGeometry = new THREE.PlaneBufferGeometry(400, 500, 10, 10);
			floorGeometry.rotateX(- Math.PI / 2);
			var position = floorGeometry.attributes.position;
			floorGeometry = floorGeometry.toNonIndexed(); // ensure each face has unique vertices

			// ceiling rendering                TODO: fix to Firestone floor!
			var ceilGeometry = new THREE.PlaneBufferGeometry(400, 500, 10, 10);
			ceilGeometry.rotateX(- Math.PI / 2);
			ceilGeometry.translate(0, 100, 0);

			// add bookshelves
			let book_scale = new THREE.Vector3(0.5, 1, 1.3);
			let book_rotation = new THREE.Vector3(0, Math.PI, 0);
			let book_rot = new THREE.Vector3(0, 0, -Math.PI);
			let zero_rot = new THREE.Vector3(0, 0, 0);

			// left
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(-50, 0, -36), book_scale, book_rot);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(-50, 0, 0), book_scale, zero_rot);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(-50, 0, -71), book_scale, book_rot);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(-50, 0, -35), book_scale, zero_rot);

			// front
			let book_front_rot1 = new THREE.Vector3(0, 0, -Math.PI/2);
			let book_front_rot2 = new THREE.Vector3(0, 0, -3* Math.PI/2);
			let book_tall = new THREE.Vector3(0.5, 1.65, 1.7);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(-43, 0, 50), book_tall, book_front_rot1);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(16, 0, 50), book_tall, book_front_rot2);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(14, 0, 50), book_tall, book_front_rot1);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(73, 0, 50), book_tall, book_front_rot2);

			// back
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(-43,0, -80), book_tall, book_front_rot1);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(16, 0,-80), book_tall, book_front_rot2);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(14, 0, -80), book_tall, book_front_rot1);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(73, 0, -80), book_tall, book_front_rot2);

			// right
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(80, 0, 9), book_scale, book_rot);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(80, 0, 45), book_scale, zero_rot);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(80, 0, -26), book_scale, book_rot);
			loadObject("./obj/bookshelf/model.dae", new THREE.Vector3(80, 0, 10), book_scale, zero_rot);

			// add pillars by bookshelves
			var geometry = new THREE.BoxGeometry(11, 11, 100);
			var material = new THREE.MeshStandardMaterial({color: 0x3f8c9b});
			geometry.rotateX(- Math.PI / 2);
			geometry.translate(-50, 50, -80);
			var pillar = new THREE.Mesh(geometry, material );
			scene.add(pillar);

			var geometry2 = new THREE.BoxGeometry(11, 11, 100);
			geometry2.rotateX(- Math.PI / 2);
			geometry2.translate(-50, 50, 50);
			var pillar2 = new THREE.Mesh(geometry2, material );
			scene.add(pillar2);

			var geometry3 = new THREE.BoxGeometry(11, 11, 100);
			geometry3.rotateX(- Math.PI / 2);
			geometry3.translate(80, 50, 50);
			var pillar3 = new THREE.Mesh(geometry3, material );
			scene.add(pillar3);

			var geometry4 = new THREE.BoxGeometry(11, 11, 100);
			geometry4.rotateX(- Math.PI / 2);
			geometry4.translate(80, 50, -80);
			var pillar4 = new THREE.Mesh(geometry4, material );
			scene.add(pillar4);

			// add mystery door in the back
			let door_scale = new THREE.Vector3(0.6, 0.6, 0.6);
			let door_rot = new THREE.Vector3(0, 0, -3 * Math.PI/2);
			loadObject("./obj/door/model.dae", new THREE.Vector3(-100, 0, -225), door_scale, door_rot);

			// add prox sensor near the door
			let sensor_scale = new THREE.Vector3(0.8, 0.8, 0.8);
			let sensor_rot = new THREE.Vector3(0, 0, 0);
			loadObject("./obj/prox_sensor/model.dae", new THREE.Vector3(-110, 20, -245), sensor_scale,sensor_rot);

			// add red point light inside sensor (to indicate LOCKED state)
			addPointLight(new THREE.Vector3(-110, 20, -240), 0xff0000, 11);

			// add wooden tables
			let big_table_scale = new THREE.Vector3(0.7, 1.2, 0.7);
			let reg_table_scale = new THREE.Vector3(0.7, 1.2, 0.7);
			let table_hor = new THREE.Vector3(0, 0, -3* Math.PI / 2);
			loadObject("./obj/wooden_table/model.dae", new THREE.Vector3(50,0, -10), big_table_scale, table_hor);

				// the two tables as you walk down straight
			loadObject("./obj/wooden_table/model.dae", new THREE.Vector3(-80,0, 100), big_table_scale, table_hor);
			loadObject("./obj/wooden_table/model.dae", new THREE.Vector3(-80,0, -50), big_table_scale, table_hor);

			// wooden tables and green chairs between red sofas and front bookshelves
			loadObject("./obj/wooden_table/model.dae", new THREE.Vector3(55, 0, 150), big_table_scale, table_hor);
			let green_chair_scale = new THREE.Vector3(0.75, 0.75, 0.75);
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(27, 0, 120), green_chair_scale, new THREE.Vector3());		// for table (55, 0, 150)
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-10, 0, 120), green_chair_scale, new THREE.Vector3());
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(47, 0, 150), green_chair_scale, new THREE.Vector3(0,0, Math.PI));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(10, 0, 150), green_chair_scale, new THREE.Vector3(0,0, Math.PI));

			// add table lamps to wooden table in the middle of the bookshelves
			let tlamp_scale = new THREE.Vector3(1, 1, 0.7);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(45, 17, -5), tlamp_scale, table_hor);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(25, 17, -5), tlamp_scale, table_hor);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(5, 17, -5), tlamp_scale, table_hor);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(-90, 17, 110), tlamp_scale, table_hor);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(-115, 17, 110), tlamp_scale, table_hor);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(-90, 17, -40), tlamp_scale, table_hor);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(-115, 17, -40), tlamp_scale, table_hor);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(45, 17, 155), tlamp_scale, table_hor);				// for table on right in front of red sofas
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(20, 17, 155), tlamp_scale, table_hor);

			// add green chairs by wooden tables
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-108, 0, 70), green_chair_scale, new THREE.Vector3());		// for table (-80,0, 100)
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-145, 0, 70), green_chair_scale, new THREE.Vector3());
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-88, 0, 100), green_chair_scale, new THREE.Vector3(0,0, Math.PI));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-125, 0, 100), green_chair_scale, new THREE.Vector3(0,0, Math.PI));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-108, 0, -75), green_chair_scale, new THREE.Vector3());			// for table (-80,0, -50)
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-145, 0, -75), green_chair_scale, new THREE.Vector3());
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-88, 0, -45), green_chair_scale, new THREE.Vector3(0,0, Math.PI));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-125, 0, -45), green_chair_scale, new THREE.Vector3(0,0, Math.PI));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(22, 0, -40), big_table_scale, new THREE.Vector3());							// for table (50,0, -10)
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-15, 0, -40), big_table_scale, new THREE.Vector3());
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(42, 0, -10), big_table_scale, new THREE.Vector3(0,0, Math.PI));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(5, 0, -10), big_table_scale, new THREE.Vector3(0,0, Math.PI));


			// add white high-back sofa
			let sofa_scale = new THREE.Vector3(0.6, 0.6, 0.8);
			let sofa_rot = new THREE.Vector3(0, 0, -Math.PI);
			loadObject("./obj/white_sofa/model.dae", new THREE.Vector3(-90, 0, 0), sofa_scale, zero_rot);
			loadObject("./obj/white_sofa/model.dae", new THREE.Vector3(-138, 0, 30), sofa_scale, sofa_rot);
			// add small wooden table between white sofas
			loadObject("./obj/wooden_table/model.dae", new THREE.Vector3(-90, 0, 25), new THREE.Vector3(0.5, 0.75, 0.5), table_hor);

			// add point lights inside table lamps
			addPointLight(new THREE.Vector3(5, 30, -45), 0xffe98c, 50);
			addPointLight(new THREE.Vector3(25, 30, -45), 0xffe98c, 50);
			addPointLight(new THREE.Vector3(45, 30, -45), 0xffe98c, 50);
			addPointLight(new THREE.Vector3(-90, 30, -40), 0xffe98c, 50); // front table lamps
			addPointLight(new THREE.Vector3(-115, 30, -40), 0xffe98c, 50); // front table lamps
			addPointLight(new THREE.Vector3(-90, 30, 110), 0xffe98c, 50); // back table lamps
			addPointLight(new THREE.Vector3(-115, 30, 110), 0xffe98c, 50); // back table lamps
			addPointLight(new THREE.Vector3(45, 30, 140), 0xffe98c, 50); // right table lamps
			addPointLight(new THREE.Vector3(20, 30, 140), 0xffe98c, 50); // right table lamps

			// add hanging lamps to scene
			let lamp_scale = new THREE.Vector3(5, 5, 3);
			loadObject("./obj/light/model.dae", new THREE.Vector3(-120, 60, 0), lamp_scale, zero_rot);
			loadObject("./obj/light/model.dae", new THREE.Vector3(-120, 60, 80), lamp_scale, zero_rot);
			loadObject("./obj/light/model.dae", new THREE.Vector3(-120, 60, -80), lamp_scale, zero_rot);

			loadObject("./obj/light/model.dae", new THREE.Vector3(120, 60, 0), lamp_scale, zero_rot);
			loadObject("./obj/light/model.dae", new THREE.Vector3(120, 60, 80), lamp_scale, zero_rot);
			loadObject("./obj/light/model.dae", new THREE.Vector3(120, 60, -80), lamp_scale, zero_rot);

			// add red sofas on the right when first walk in
			let red_chair_scale = new THREE.Vector3(1,1,1);
			loadObject("./obj/red_chair/model.dae", new THREE.Vector3(-50, 0, 240), red_chair_scale, new THREE.Vector3(0,0,1.65));	// for coffee table (-50, 0, 225)
			loadObject("./obj/red_chair/model.dae", new THREE.Vector3(30, 0, 230), red_chair_scale, new THREE.Vector3(0,0,-3.9));
			loadObject("./obj/red_chair/model.dae", new THREE.Vector3(75, 0, 240), red_chair_scale, new THREE.Vector3(0,0,1.65));	// for coffee table (45, 0, 225)
			loadObject("./obj/red_chair/model.dae", new THREE.Vector3(155, 0, 230), red_chair_scale, new THREE.Vector3(0,0,-3.9));

			// add small round coffee tables to between red sofas on the right
			let coffee_table_scale = new THREE.Vector3(1,1,1);
			loadObject("./obj/coffee_table/model.dae", new THREE.Vector3(-50, 0, 225), coffee_table_scale, zero_rot);
			loadObject("./obj/coffee_table/model.dae", new THREE.Vector3(75, 0, 225), coffee_table_scale, zero_rot);

			// add round tables in the back, next to "secret" door
			let round_table_scale = new THREE.Vector3(0.2, 0.2, 0.2);
			loadObject("./obj/large_round_table/model.dae", new THREE.Vector3(-35, 0, -200), round_table_scale, zero_rot);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(-25, 19, -182), tlamp_scale, table_hor);
			addPointLight(new THREE.Vector3(-20, 32, -190), 0xffe98c, 50);
			addPointLight(new THREE.Vector3(-40, 32, -190), 0xffe98c, 50);
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-25, 0, -210), green_chair_scale, new THREE.Vector3(0,0,-1.2));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-50, 0, -200), green_chair_scale, new THREE.Vector3(0,0, 1));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(-35, 0, -185), green_chair_scale, new THREE.Vector3(0,0, -3.4));

			loadObject("./obj/large_round_table/model.dae", new THREE.Vector3(50, 0, -200), round_table_scale, zero_rot);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(60, 19, -182), tlamp_scale, table_hor);
			addPointLight(new THREE.Vector3(55, 32, -190), 0xffe98c, 50);
			addPointLight(new THREE.Vector3(20, 32, -190), 0xffe98c, 50);
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(60, 0, -210), green_chair_scale, new THREE.Vector3(0,0,-1.2));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(35, 0, -200), green_chair_scale, new THREE.Vector3(0,0, 1));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(50, 0, -185), green_chair_scale, new THREE.Vector3(0,0, -3.4));

			loadObject("./obj/large_round_table/model.dae", new THREE.Vector3(130, 0, -200), round_table_scale, zero_rot);
			loadObject("./obj/table_lamp/model.dae", new THREE.Vector3(140, 19, -182), tlamp_scale, table_hor);
			addPointLight(new THREE.Vector3(135, 32, -190), 0xffe98c, 50);
			addPointLight(new THREE.Vector3(100, 32, -190), 0xffe98c, 50);
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(140, 0, -210), green_chair_scale, new THREE.Vector3(0,0,-1.2));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(115, 0, -200), green_chair_scale, new THREE.Vector3(0,0, 1));
			loadObject("./obj/green_chair/model.dae", new THREE.Vector3(130, 0, -185), green_chair_scale, new THREE.Vector3(0,0, -3.4));




			// add lights inside lamps
			addPointLight(new THREE.Vector3(-120, 40, 0), 0xf2d637, 90);
			addPointLight(new THREE.Vector3(-120, 40, 80), 0xf2d637, 90);
			addPointLight(new THREE.Vector3(-120, 40, -80), 0xf2d637, 90);

			addPointLight(new THREE.Vector3(120, 40, 0), 0xf2d637, 90);
			addPointLight(new THREE.Vector3(120, 40, 80), 0xf2d637, 90);
			addPointLight(new THREE.Vector3(120, 40, -80), 0xf2d637, 90);

			renderer = new THREE.WebGLRenderer({ antialias: true });
			renderer.setPixelRatio(window.devicePixelRatio);
			renderer.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(renderer.domElement);

			var floortexture = new THREE.TextureLoader().load('textures/carpet.jpg', render);
			floortexture.anisotropy = renderer.capabilities.getMaxAnisotropy();
			floortexture.wrapS = floortexture.wrapT = THREE.RepeatWrapping;
			floortexture.offset.set(0, 0);
			floortexture.repeat.set(40, 40);

			var floorMaterial = new THREE.MeshStandardMaterial({ map: floortexture});

			var floor = new THREE.Mesh(floorGeometry, floorMaterial);
			scene.add(floor);

			// add walls
			var wallMaterial = new THREE.MeshStandardMaterial({ color: 0xfffaef, side: THREE.DoubleSide});
			var back_wall = new THREE.Mesh(southWallGeometry, wallMaterial);
			scene.add(back_wall);

			var right_wall = new THREE.Mesh(rightWallGeometry, wallMaterial);
			scene.add(right_wall);

			var left_wall = new THREE.Mesh(leftWallGeometry, wallMaterial);
			scene.add(left_wall);

			var front_wall = new THREE.Mesh(frontWallGeometry, wallMaterial);
			scene.add(front_wall);

			var ceilMaterial = new THREE.MeshStandardMaterial({ color: 0xa8a7a4, side: THREE.DoubleSide});
			var ceil = new THREE.Mesh(ceilGeometry, ceilMaterial);
			scene.add(ceil);

			window.addEventListener('resize', onWindowResize, false);

			// add sample items
			playerInventory.addItem('key', 1);
			playerInventory.addItem('fuse', 1);
			playerInventory.refreshRender();
		}

		// adds point light to the specified position
		function addPointLight(pos, color, intensity) {
			var light = new THREE.PointLight(color, 1, intensity);
			light.position.set(pos.x, pos.y, pos.z);
			scene.add(light);
		}

		// loads object from the given filepath and adds it to the scene
		function loadObject(filepath, pos, scale, rotation) {

			var loader = new THREE.ColladaLoader();
			var obj;
			loader.convertUpAxis = true;
			loader.load(filepath, function ( collada ) {

				obj = collada.scene;
				obj.position.x= pos.x;
				obj.position.y= pos.y;
				obj.position.z= pos.z;
				obj.scale.x = scale.x;
				obj.scale.y = scale.y;
				obj.scale.z = scale.z;
				obj.rotation.x += rotation.x;
				obj.rotation.y += rotation.y;
				obj.rotation.z += rotation.z;

				obj.castShadow = true;
				objects.push(obj);
				scene.add(obj);
			});
		}

		function onWindowResize() {
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			renderer.setSize(window.innerWidth, window.innerHeight);
		}


		function animate() {                                     // This part is for jumping, which requires animation --> good to know, unsure if necessary in our game, we can keep just in case? Or we can have one of the clues, such as the fuse box, that can only be seen if you jump up?
			requestAnimationFrame(animate);

			if (controls.isLocked === true) {
				raycaster.ray.origin.copy(controls.getObject().position);
				raycaster.ray.origin.y -= 10;
				var intersections = raycaster.intersectObjects(objects);
				var onObject = intersections.length > 0;
				var time = performance.now();
				var delta = (time - prevTime) / 1000;
				velocity.x -= velocity.x * 10.0 * delta;
				velocity.z -= velocity.z * 10.0 * delta;
				velocity.y -= 9.8 * 100.0 * delta; // 100.0 = mass
				direction.z = Number(moveForward) - Number(moveBackward);
				direction.x = Number(moveLeft) - Number(moveRight);
				direction.normalize(); // this ensures consistent movements in all directions
				if (moveForward || moveBackward) velocity.z -= direction.z * 400.0 * delta;
				if (moveLeft || moveRight) velocity.x -= direction.x * 400.0 * delta;
				if (onObject === true) {
					velocity.y = Math.max(0, velocity.y);
					canJump = true;
				}


				// Code to handle not going through objects
				// ------------------ START ---------------------
				var curr_pos = controls.getObject().position.clone();
				var obj_too_close = [];		// list of objects that camera is too close to
				var new_pos;
				for (var i = 0; i < objects.length; i++) {
				  var obj_pos = objects[i].position;
				  if (obj_pos.distanceTo(curr_pos) < 2)  // too close
				    obj_too_close.push(objects[i]);
				}

				if (obj_too_close.length == 0) {				// not too close to any obj
				  controls.getObject().translateX(velocity.x * delta);
				  controls.getObject().position.y += (velocity.y * delta); // new behavior
				  controls.getObject().translateZ(velocity.z * delta);
				}
				else {
				  for (var i = 0; i < obj_too_close.length; i++) {
				    var obj_pos = obj_too_close[i].position;

				    var dist = obj_pos.distanceTo(curr_pos);
				    var new_pos = curr_pos.clone();
				    var x_change = new THREE.Vector3(velocity.x * delta, 0, 0);
				    var y_change = new THREE.Vector3(0, velocity.y * delta, 0);
				    var z_change = new THREE.Vector3(0, 0, velocity.z * delta);

				    if (new_pos.clone().add(x_change).distanceTo(obj_pos) > dist)
				      controls.getObject().translateX(velocity.x * delta);
				    if (new_pos.clone().add(y_change).distanceTo(obj_pos) > dist)
				      controls.getObject().position.y += (velocity.y * delta);
				    if (new_pos.clone().add(z_change).distanceTo(obj_pos) > dist)
				      controls.getObject().translateZ(velocity.z * delta);
				  }
				}
				// ------------------ END ---------------------



				if (controls.getObject().position.y < 25) {
					velocity.y = 0;
					controls.getObject().position.y = 25;
					canJump = true;
				}
				prevTime = time;
			}
			renderer.render(scene, camera);
		}

		function render() {
			requestAnimationFrame(render);
			renderer.render(scene, camera);
		}


	</script>
</body>

</html>
